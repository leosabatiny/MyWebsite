<!-- cube-explainer.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Cube Code Explainer â€“ Leonardo</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-okaidia.min.css" rel="stylesheet" />
    <style>
        #explainer-content { padding-top: 2rem; display: flex; flex-direction: column; gap: 2rem; }
        .code-block { border: 1px solid var(--border-color); border-radius: 8px 8px 0 0; overflow: hidden; background: var(--bg-surface); }
        .code-block pre[class*="language-"] { margin: 0 !important; border-radius: 0 !important; background: transparent !important; white-space: pre-wrap; word-break: break-all; padding: 1rem; }
        .explanation-block { background-color: var(--bg-dark); border: 1px solid var(--border-color); border-top: none; border-radius: 0 0 8px 8px; padding: 1.5rem; margin-top: -1px; }
        .explanation-block h3 { margin-top: 0; color: var(--text-primary); }
        .explanation-block p { color: var(--text-secondary); font-size: 0.95rem; margin: 0; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a href="index.html" class="logo">Leonardo</a>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="projects.html">Projects</a></li>
                <li><a href="physics-cube.html">Back to Cube</a></li>
            </ul>
        </div>
    </nav>
    
    <div class="page-section">
        <div class="container">
            <h2>3D Cube Code Explainer</h2>
            <p>The code for the 3D physics simulation is broken down below, with a clear explanation for each block.</p>
            <div id="explainer-content"> <p>Loading code...</p> </div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const explainerContent = document.getElementById('explainer-content');

            const explanations = {
                'setup': { title: 'Scene, Camera, & Renderer', text: 'This is the foundational setup for any Three.js project. The `Scene` is the container for all objects. The `PerspectiveCamera` is our virtual eye. The `WebGLRenderer` is the engine that takes the scene and camera information and draws it onto the screen.' },
                'lighting': { title: 'Lighting the Scene', text: 'A 3D scene needs light to see objects. `AmbientLight` provides a soft, baseline light everywhere. `DirectionalLight` acts like the sun, casting light from a specific direction to create highlights and shadows, giving objects depth.' },
                'physics-world': { title: 'The Physics World', text: 'Here, we create a separate, invisible "world" using the Cannon-es.js library. We set its `gravity` to a value stronger than Earth\'s for a more dynamic feel, which pulls on all objects with mass.' },
                'materials': { title: 'Defining Bounciness', text: 'In physics, materials define how objects interact. We create a `ContactMaterial` to specify the `restitution` (bounciness) and `friction` between the ball and the cube walls. This is what makes the ball bounce realistically.' },
                'ball': { title: 'Creating the Ball', text: 'Every object has two parts: a visible mesh (`sphereMesh` from Three.js) and an invisible physics body (`sphereBody` from Cannon.js). We create both, giving the physics body properties like mass and a spherical shape.' },
                'cube': { title: 'Building the Container Cube', text: 'The cube is created as 6 thin walls. For efficiency, we create one single physics body (`cubeBody`) with a mass of 0 (making it static) and add 6 box-shaped collision "shapes" to it, one for each wall.' },
                'animation-loop': { title: 'The Animation Loop', text: 'This is the heart of the simulation. In each frame, we first update the rotation of the visual cube. Then, we tell the physics world to `step` forward in time, calculating all collisions and movements. Finally, we copy the new position from the invisible physics ball to the visible ball mesh.' },
                'ui-logic': { title: 'UI & Window Logic', text: 'This block handles user interaction. The `resize` listener ensures the 3D scene doesn\'t get distorted when the browser window changes size. The `mousemove` listener checks the cursor\'s position to make the header and footer appear when the mouse approaches the top or bottom of the screen.' }
            };
            
            async function initializeExplainer() {
                try {
                    const response = await fetch('physics-cube.html');
                    if (!response.ok) throw new Error('Network response was not ok');
                    const htmlText = await response.text();

                    const scriptMatch = htmlText.match(/<script type="module">([\s\S]*?)<\/script>/);
                    if (!scriptMatch || !scriptMatch[1]) throw new Error('Script content not found.');
                    
                    const rawCode = scriptMatch[1].trim();
                    explainerContent.innerHTML = '';
                    const regionOrder = ['setup', 'lighting', 'physics-world', 'materials', 'ball', 'cube', 'animation-loop', 'ui-logic'];

                    for (const key of regionOrder) {
                        const startMarker = `// REGION START: ${key}`;
                        const endMarker = `// REGION END: ${key}`;
                        const regionRegex = new RegExp(`${startMarker}[\\s\\S]*?${endMarker}`);
                        const match = rawCode.match(regionRegex);

                        if (match) {
                            let codeString = match[0].replace(startMarker, '').replace(endMarker, '').trim();
                            createCodeExplanationPair(key, codeString);
                        }
                    }
                    Prism.highlightAll();
                } catch (error) {
                    console.error('Failed to load or process code:', error);
                    explainerContent.innerHTML = '<p>Failed to load code. Please ensure you are running this from a local server.</p>';
                }
            }

            function createCodeExplanationPair(key, codeString) {
                const explanation = explanations[key];
                if (!explanation) return;
                const codeBlockDiv = document.createElement('div');
                codeBlockDiv.className = 'code-block';
                const pre = document.createElement('pre');
                const code = document.createElement('code');
                code.className = 'language-javascript';
                code.textContent = codeString;
                pre.appendChild(code);
                codeBlockDiv.appendChild(pre);
                const explanationDiv = document.createElement('div');
                explanationDiv.className = 'explanation-block';
                explanationDiv.innerHTML = `<h3>${explanation.title}</h3><p>${explanation.text}</p>`;
                explainerContent.appendChild(codeBlockDiv);
                explainerContent.appendChild(explanationDiv);
            }

            initializeExplainer();
        });
    </script>
</body>
</html>